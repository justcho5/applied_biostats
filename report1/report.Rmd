---
title: The Effect of the Method of Cutting on the Moisture Content of Samples from
  Tree Branches
geometry: margin=2.5cm
output:
  pdf_document:
    highlight: zenburn
    toc: no
  html_document:
    df_print: paged
    toc: no
fontsize: 12pt
author:
- "Hyun Jii Cho"
- "Kirusanth Poopalasingam"
header-includes: |
    \usepackage{fancyhdr}
    \pagestyle{fancy}
    \fancyhead[CO,CE]{Hyun Jii, Poopalasingam}
---

---
# Your report should contain a short background/intro to the problem (including the aim of the original study).
# 
# A presentation of the results of your 
# - statistical analyses
# - including exploratory data analysis
# - model fitting and final model
# - along with a short discussion of any shortcomings of the final model
# - your conclusions
---

## Problem

In order to measure the water content of a woody structure, samples were taken from the branch. 
Water can be lost during the cut and make the moisture content and therefore the sample unreliable. 
In this study different cutting methods have been compared for their water loss. 

Four different sample with two different cuts were taken from a single branch. The first cut was done simultaneously in the middle of the branch. The next two cuts were performed after each other on both ends of the branch.

The xylem elements, which transport the water in the branch, are under tension. Cutting the branch on one end will result the tension to be released on that end and cause the removal of water. On the other hand, cutting them on both ends will result the tension to be reliefed on both ends and result in lesser water loss. 

The aim is to find the optimal method in order to minimize the water loss during the cut. The original question posed by the study was if there is a difference in the moisture content between adjacent samples of the same branch. 

## Exploratory Analysis

## Result

```{r, echo=FALSE}
## this is how you can 
library(reticulate)
file <- read.table('tree-moisture.txt', 
                 col.names = c("Species", "Branch", "Location", "TranspirationType", "Moisture"))
file$Species[file$Species==1]<-"LP"
file$Species[file$Species==2]<-"SP"
file$Species[file$Species==3]<-"YP"
file$Species[file$Species==4]<-"RG"
file$Location[file$Location ==1]<-"Central"
file$Location[file$Location ==2]<-"Distal"
file$Location[file$Location ==3]<-"Proximal"
file$TranspirationType[file$TranspirationType==1]<-"Rapid"
file$TranspirationType[file$TranspirationType==2]<-"Slow"
moisture <-file[,c("Species", "Location", "TranspirationType", "Moisture")]
species <- factor(c(moisture$Species))
location <- factor(c(moisture$Location))
transpiration <- factor(c(moisture$TranspirationType))
moisture$Species <- species
moisture$Location <- location
moisture$TranspirationType <- transpiration
moisture$Moisture <- moisture$Moisture/10
```
### Hypotheses:
- H0: The means of all species groups are equal.
- H1: The mean of at least one species group is different.

- H0: The means of the location groups are equal.
- H1: The mean of at least one species group is different.

- H0: The means of the transpiration type groups are equal.
- H1: The means of the transpiration type groups are different.

- H0: There is no interaction between species and location of cut.
- H1: There is interaction between species and location of cut.

- H0: There is no interaction between species and transpiration type.
- H1: There is interaction between species and transpiration type.

- H0: There is no interaction between location of cut and transpiration type.
- H1: There is interaction between location of cut and transpiration type.

### Exploratory data analysis

#### Data Format

```{r, echo=FALSE}
library(knitr)
kable(head(file), caption = "Data extract")
```

The data contains the moisture content measurement for each species, location and transpiration type. Five samples were taken for each combination.

#### Means for each combination of **species**, **location**, **transpiration type**

```{r, echo=FALSE}
library(knitr)
library(kableExtra)

mean <- tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType),mean)

kable(mean, caption = "Mean Moisture")

x <- kable(mean, col.names = c("Central", "Distal", "Proximal", "Central", "Distal", "Proximal")) 
kable_styling(x, "striped")
add_header_above(x, c(" " = 1, "Rapid" = 3, "Slow" = 3))
      
```



```{r, echo=FALSE}
sd <- tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType), sd)

median <-tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType), median)

min <-tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType), min)
max<-tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType), max)

#head(mean)
#mean
#sd
#median
#min
#max

#str(moisture)
```

## Interactions

```{r, echo=FALSE}
plot.design(moisture)
```

As we can see, the mean of moisture differs mostly for different species.

##### ANOVA Models
```{r, echo=FALSE}
op <-par(mfrow = c(3,1))
?par()
par(mar=c(2,2,2,5))

with(moisture, {
  interaction.plot(moisture$Location, moisture$Species, moisture$Moisture,  
                   xlab = "Location", ylab = "Moisture", trace.label="Species")
  interaction.plot(moisture$TranspirationType, moisture$Species, moisture$Moisture, 
                   xlab = "Transpiration", ylab = "Moisture", trace.label="Species")
  
  interaction.plot(moisture$TranspirationType, moisture$Location, moisture$Moisture,  
                   xlab = "Transpiration", ylab = "Moisture", trace.label="Location")  
})
par(op)
```

Analysis for interaction plots
Above, we ob
##### Full model with the three factors considered
```{r, echo=FALSE}

modelmatrix = model.matrix(~Species*Location*TranspirationType, moisture)

m <- aov(Moisture ~ Species*TranspirationType*Location, data = moisture)
summary(m)

```
##### coefficients

```{r, echo=FALSE}
m2 <- update(m, . ~ . - Species:TranspirationType:Location)
summary(m2)
```
```{r, echo=FALSE}
anova(m, m2)
model.tables(m2, type="effects")
model.tables(m2, type="means")


m3 <- update(m2, . ~ . - Species:Location)
m3 <- update(m3, . ~ . - TranspirationType:Location)
summary(m3)

```

coef(m_specieslocation.aov)
coef(m_speciestranspiration.aov)
coef(m_locationtranspiration.aov)


##### INTERACTION PLOTS




```{r, echo=FALSE}
layout(matrix(1:4,ncol=2)) 

plot(m3)
```

### 2-way ANOVA
#### 3 2-way ANOVA tests
##### Species vs. Location


##### Species vs Transpiration Type



##### Location vs Transpiration Type
## Summary

