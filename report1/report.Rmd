---
title: The Effect of the Method of Cutting on the Moisture Content of Samples from
  Tree Branches
geometry: margin=2.5cm
output:
  html_document:
    df_print: paged
    toc: no
  pdf_document:
    highlight: zenburn
    toc: no
fontsize: 12pt
author:
- "Hyun Jii Cho"
- "Kirusanth Poopalasingam"
header-includes: |
    \usepackage{fancyhdr}
    \pagestyle{fancy}
    \fancyhead[CO,CE]{Hyun Jii, Poopalasingam}
---

---
# Your report should contain a short background/intro to the problem (including the aim of the original study).
# 
# A presentation of the results of your 
# - statistical analyses
# - including exploratory data analysis
# - model fitting and final model
# - along with a short discussion of any shortcomings of the final model
# - your conclusions
---

## Problem
In this project, we analyze a dataset of moisture content from tree branch samples in order to understand how moisture content changes with the method of cutting. Water can be lost during the cut and make the moisture content and therefore the sample unreliable. For this study, samples were taken from branches to measure the water content of a woody structure. Four different sample with two different cuts were taken from a single branch. The first cut was done simultaneously in the middle of the branch. The next two cuts were performed after each other on both ends of the branch.

The xylem elements, which transport the water in the branch, are under tension. Cutting the branch on one end will result the tension to be released on that end and cause the removal of water. On the other hand, cutting them on both ends will result the tension to be reliefed on both ends and result in lesser water loss. 

The aim is to find the optimal method in order to minimize the water loss during the cut. The original question posed by the study was if there is a difference in the moisture content between adjacent samples of the same branch.
```{r, echo=FALSE}
### Hypotheses:
#- H0: The means of all species groups are equal.
#- H1: The mean of at least one species group is different.

#- H0: The means of the location groups are equal.
#- H1: The mean of at least one species group is different.

#- H0: The means of the transpiration type groups are equal.
#- H1: The means of the transpiration type groups are different.

#- H0: There is no interaction between species and location of cut.
#- H1: There is interaction between species and location of cut.

#- H0: There is no interaction between species and transpiration type.
#- H1: There is interaction between species and transpiration type.

#- H0: There is no interaction between location of cut and transpiration type.
#- H1: There is interaction between location of cut and transpiration type.

#-H0: There is no interaction between all three factors.
#-H1: There are interaction among all three factors.
```
## Exploratory Analysis
First, we will have briefly analyze the dataset to get some insights into how the different factors may affect the moisture content in branches.

```{r, echo=FALSE}
## this is how you can 
library(reticulate)
file <- read.table('tree-moisture.txt', 
                 col.names = c("Species", "Branch", "Location", "TranspirationType", "Moisture"))
file$Species[file$Species==1]<-"LP"
file$Species[file$Species==2]<-"SP"
file$Species[file$Species==3]<-"YP"
file$Species[file$Species==4]<-"RG"
file$Location[file$Location ==1]<-"Central"
file$Location[file$Location ==2]<-"Distal"
file$Location[file$Location ==3]<-"Proximal"
file$TranspirationType[file$TranspirationType==1]<-"Rapid"
file$TranspirationType[file$TranspirationType==2]<-"Slow"
moisture <-file[,c("Species", "Location", "TranspirationType", "Moisture")]
species <- factor(c(moisture$Species))
location <- factor(c(moisture$Location))
transpiration <- factor(c(moisture$TranspirationType))
moisture$Species <- species
moisture$Location <- location
moisture$TranspirationType <- transpiration
moisture$Moisture <- moisture$Moisture/10
```

#### Data Format

```{r, echo=FALSE}
library(knitr)
kable(head(file), caption = "Data extract")
```

The data contains the moisture content measurement for each species, location and transpiration type. Five samples were taken for each combination.

#### Means for each combination of **species**, **location**, **transpiration type**

```{r, echo=FALSE}
library(knitr)
library(kableExtra)

mean <- tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType),mean)

kable(mean, col.names = c("Central", "Distal", "Proximal", "Central", "Distal", "Proximal"))
#kable_styling(x, "striped")
#add_header_above(x, c(" " = 1, "Rapid" = 3, "Slow" = 3))
      
```



```{r, echo=FALSE}
sd <- tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType), sd)

median <-tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType), median)

min <-tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType), min)
max<-tapply(moisture$Moisture, list(moisture$Species, moisture$Location, moisture$TranspirationType), max)

#head(mean)
#mean
#sd
#median
#min
#max

#str(moisture)
```

## Interactions

```{r, echo=FALSE}
plot.design(moisture)
```
=======
Plot of univariate factor effects on Moisture content variable.
The mean of the moisture content seems to change with all the factors, Species, Location, Transpiration type. It would be interesting to also see whether different combinations of the levels of the factors different influence the moisture content of branches. For example we can see whether a specific species, combined with a specific level of Transpiration type affects the moisture content by observing the two-way interaction plot between pairs of factors.

```{r, echo=FALSE}
#boxplot(moisture$Moisture ~ moisture$Location, data = moisture )
```


##### ANOVA Models
```{r, echo=FALSE}
op <-par(mfrow = c(3,1))
?par()
par(mar=c(2,2,2,5))

with(moisture, {
  interaction.plot(moisture$Location, moisture$Species, moisture$Moisture,  
                   xlab = "Location", ylab = "Moisture", trace.label="Species")
  interaction.plot(moisture$TranspirationType, moisture$Species, moisture$Moisture, 
                   xlab = "Transpiration", ylab = "Moisture", trace.label="Species")
  
  interaction.plot(moisture$TranspirationType, moisture$Location, moisture$Moisture,  
                   xlab = "Transpiration", ylab = "Moisture", trace.label="Location")  
})
par(op)
```

Plots of two-way interaction effects of factors on the moisture content variable.
Above, we observe that there may be an interaction between transpiration type and species, such that the species may affect the moisture content differently based on whether the transpiration type is rapid or slow.

##### Full model with the three factors considered

In order to say whether the differences between several means plotted are significant, we build an ANOVA model and test each factor and interaction in the model. First we will build a full model with the three factors considered, the two-way interactions between all factors, and the three-way interaction.
```{r, echo=FALSE}

modelmatrix = model.matrix(~Species*Location*TranspirationType, moisture)
m <- aov(Moisture ~ Species*TranspirationType*Location, data = moisture)
summary(m)

```

 All the factors individually appear to affect the mean of the moisutre content, which we observed in the initial means plot. In addition, the species transpiration type factors appear to interact; whereas the other 2-way interactions are not statistically significant. We are interested in finding the best fitted model which explains the variability in the data. Thus we start by dropping the highest-level interactions (3-way).
```{r, echo=FALSE}
m2 <- update(m, . ~ . - Species:TranspirationType:Location)
summary(m2)
```
We check whether the three removed effects together are still not significant.

```{r, echo=FALSE}
anova(m, m2)

```
The combined effect of the three-way interactions is not significant, so we continue on with the model with the main effects only.
```{r, echo=FALSE}

```
The species:location and transpiration type:location appear not to interact so similarly, we remove those two-way interactions. Finally, we remove the two 2-way interactions to obtain the final model with only significant effects
```{r, echo=FALSE}
m3 <- update(m2, . ~ . - Species:Location)
m3 <- update(m3, . ~ . - TranspirationType:Location)
summary(m3)

```
```{r, echo=FALSE}
#coef(m_specieslocation.aov)
#coef(m_speciestranspiration.aov)
#coef(m_locationtranspiration.aov)
```



```{r, echo=FALSE}
layout(matrix(1:4,ncol=2)) 
plot(m3)
```

```{r, echo=FALSE}
#moisture %>% dplyr::group_by(moisture$Species, moisture$TranspirationType) %>% dplyr::summarise(mean(Moisture))
```

###along with a short discussion of any shortcomings of the final model
# - your conclusions

Conclusion:


